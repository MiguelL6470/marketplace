"use strict";(()=>{var e={};e.id=684,e.ids=[684],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},99676:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>C,requestAsyncStorage:()=>E,routeModule:()=>_,serverHooks:()=>v,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>m,revalidate:()=>p});var i=t(49303),n=t(88716),o=t(60670),a=t(87070),l=t(95456),c=t(75748),u=t(1184);let p=15;async function d(e){let r=Object.fromEntries(new URL(e.url).searchParams.entries()),t=u.Ow.safeParse(r);if(!t.success)return a.NextResponse.json({error:"invalid_query"},{status:400});let{q:s,category:i,minPrice:n,maxPrice:o,page:l,pageSize:p}=t.data,d={status:"ACTIVE",...i?{category:{slug:i}}:{},...void 0!==n||void 0!==o?{priceCents:{gte:n??0,lte:o??2147483647}}:{}};if(!s){let[e,r]=await Promise.all([c._.product.findMany({where:d,select:{id:!0,title:!0,slug:!0,priceCents:!0,images:{orderBy:{position:"asc"},take:1}},orderBy:{createdAt:"desc"},skip:(l-1)*p,take:p}),c._.product.count({where:d})]);return a.NextResponse.json({items:e,total:r,page:l,pageSize:p})}d.OR=[{title:{contains:s,mode:"insensitive"}},{description:{contains:s,mode:"insensitive"}}];let[m,_]=await Promise.all([c._.product.findMany({where:d,select:{id:!0,title:!0,slug:!0,priceCents:!0,images:{orderBy:{position:"asc"},take:1}},orderBy:{createdAt:"desc"},skip:(l-1)*p,take:p}),c._.product.count({where:d})]);return a.NextResponse.json({items:m,total:_,page:l,pageSize:p})}async function m(e){let r=await (0,l.F)();if(!r?.user)return a.NextResponse.json({error:"unauthorized"},{status:401});let t=await e.json().catch(()=>null),s=u.zC.safeParse(t);if(!s.success)return a.NextResponse.json({error:"invalid_body",details:s.error.format()},{status:400});let i=await c._.merchant.findUnique({where:{userId:r.user.id}});if(!i)return a.NextResponse.json({error:"merchant_required"},{status:403});let n=s.data,o=n.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),p=`${o}-${Math.random().toString(36).slice(2,7)}`,d=await c._.product.create({data:{merchantId:i.id,title:n.title,slug:p,description:n.description,priceCents:n.priceCents,stock:n.stock,status:"ACTIVE",categoryId:n.categoryId,images:{create:n.images.map(e=>({url:e.url,alt:e.alt??null,position:e.position??0}))}},include:{images:!0}});return a.NextResponse.json({product:d})}let _=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"/home/miguel/projects/marketplace/src/app/api/products/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:E,staticGenerationAsyncStorage:x,serverHooks:v}=_,g="/api/products/route";function C(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:x})}},26109:(e,r,t)=>{t.d(r,{L:()=>u});var s=t(77234),i=t(70575),n=t(24459),o=t(13539),a=t(75748);let l=[];process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&l.push((0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})),process.env.APPLE_CLIENT_ID&&process.env.APPLE_CLIENT_SECRET&&l.push((0,i.Z)({clientId:process.env.APPLE_CLIENT_ID,clientSecret:process.env.APPLE_CLIENT_SECRET})),process.env.FACEBOOK_CLIENT_ID&&process.env.FACEBOOK_CLIENT_SECRET&&l.push((0,n.Z)({clientId:process.env.FACEBOOK_CLIENT_ID,clientSecret:process.env.FACEBOOK_CLIENT_SECRET})),process.env.NEXTAUTH_SECRET||console.warn("NEXTAUTH_SECRET is not set. This is required for production."),process.env.DATABASE_URL||console.warn("DATABASE_URL is not set. This is required for production.");let c=l.length>0?l:[(0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"placeholder",clientSecret:process.env.GOOGLE_CLIENT_SECRET||"placeholder"})],u={adapter:(0,o.N)(a._),providers:c,callbacks:{async session({session:e,user:r}){if(e.user){if(r&&"role"in r)e.user.id=r.id,e.user.role=r.role;else{let r=await a._.user.findUnique({where:{email:e.user.email},select:{role:!0}});r&&(e.user.role=r.role)}}return e}},pages:{signIn:"/login"},session:{strategy:"database"},secret:process.env.NEXTAUTH_SECRET}},95456:(e,r,t)=>{t.d(r,{F:()=>o});var s=t(75571),i=t(26109),n=t(75748);async function o(){try{let e=await (0,s.getServerSession)(i.L);if(!e?.user?.email)return null;let r=await n._.user.findUnique({where:{email:e.user.email},select:{id:!0,email:!0,name:!0,role:!0}});if(!r)return null;return{user:{id:r.id,email:r.email,name:r.name,role:r.role}}}catch(e){return console.error("Error getting server auth:",e),null}}},75748:(e,r,t)=>{t.d(r,{_:()=>i});var s=t(53524);let i=globalThis.prismaGlobal??new s.PrismaClient},1184:(e,r,t)=>{t.d(r,{Ow:()=>o,Tu:()=>a,cb:()=>i,zC:()=>n});var s=t(21067);let i=s.Ry({storeName:s.Z_().min(2).max(80),description:s.Z_().max(500).optional().or(s.i0("")),logoUrl:s.Z_().url().optional(),phone:s.Z_().max(40).optional(),address:s.Z_().max(200).optional()}),n=s.Ry({title:s.Z_().min(2).max(120),description:s.Z_().min(1).max(2e3),priceCents:s.Rx().int().min(0),stock:s.Rx().int().min(0).default(0),categoryId:s.Z_().cuid(),images:s.IX(s.Ry({url:s.Z_().url(),alt:s.Z_().max(120).optional(),position:s.Rx().int().min(0).default(0)})).max(8).default([])}),o=s.Ry({q:s.Z_().optional(),category:s.Z_().optional(),minPrice:s.oQ.number().int().min(0).optional(),maxPrice:s.oQ.number().int().min(0).optional(),page:s.oQ.number().int().min(1).default(1),pageSize:s.oQ.number().int().min(1).max(50).default(20)}),a=s.Ry({name:s.Z_().min(2,"Nome deve ter pelo menos 2 caracteres").max(100),email:s.Z_().email("Email inv\xe1lido"),password:s.Z_().min(8,"Senha deve ter pelo menos 8 caracteres").max(100)});s.Ry({email:s.Z_().email("Email inv\xe1lido"),password:s.Z_().min(1,"Senha \xe9 obrigat\xf3ria")})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[948,615,958,972,67],()=>t(99676));module.exports=s})();